<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>菜单管理</title>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="well form-inline">
            <input type="button" id="system_menu_add" value="添加同级" class="form-control btn-info"/>
            <input type="button" id="system_menu_addChild" value="添加子级" class="disabled form-control btn-info"/>
            <input type="button" id="system_menu_update" value="修改" class="form-control btn-info"/>
            <input type="button" id="system_menu_delete" value="删除" class="form-control btn-danger"/>
        </div>
    </div>

    <div class="row" style="margin-top: -20px">
        <div id="system_menu_treeView"></div>
    </div>
</div>
<script type="text/javascript">
    $(function () {
        let headUrl = "controllerPage/system/";

        let treeViewId = "#system_menu_treeView";
        loadTreeView();

        function loadTreeView() {
            let treeData;
            $.ajax({
                url: "systemMenu/queryAll",
                async: false,
                success: function (data) {
                    treeData = data;
                }
            })
            $(treeViewId).treeview({
                data: treeData,
                showTags: true,
                onNodeSelected: function (event, node) {

                    if (/(添加|修改|删除|-)+/.test(node.text)) {
                        $("#system_menu_addChild").addClass("disabled").css("cursor", "not-allowed");
                    } else {
                        $("#system_menu_addChild").removeClass("disabled").css("cursor", "pointer");
                    }
                }
            })
        }

        let node;
        $("#system_menu_add").click(function () {
            if (isSelectedTreeView()) {
                node = $(treeViewId).treeview("getSelected")[0];
                myDialogModal("添加菜单", headUrl + "menuJsp/add.jsp?parentIds=" + node.parentIds);
            }
        })

        $("#system_menu_addChild").click(function () {
            if(myDisabledButton(this))return
            if (isSelectedTreeView()) {
                node = $(treeViewId).treeview("getSelected")[0];
                //获取子的节点的 parentIds
                myDialogModal("添加菜单", headUrl + "menuJsp/add.jsp?parentIds=" + node.id);
            }
        })
        $("#system_menu_update").click(function () {
            if (isSelectedTreeView()) {
                node = $(treeViewId).treeview("getSelected")[0];
                myDialogModal("修改菜单", headUrl + "menuJsp/upate.jsp?id=" + node.id);
            }
        })
        $("#system_menu_delete").click(function () {
            if (isSelectedTreeView()) {
                node = $(treeViewId).treeview("getSelected")[0];
                myConfirm("删除提示", "是否要删除菜单: " + node.text, function (t) {
                    $.ajax({
                        url: 'systemMenu/deleteMenuId',
                        data: {id: node.id},
                        dataType: 'json',
                        success: function (data) {
                            myAlert("删除提示", "删除" + data ? '成功' : '失败' + "!")
                        }
                    })
                });
            }
        })

        function isSelectedTreeView() {
            node = $(treeViewId).treeview("getSelected");
            if (node.length === 0) {
                myAlert("提示信息:", "请选择菜单！！！")
                return false;
            }
            return true;
        }
    })

</script>
</body>
</html>